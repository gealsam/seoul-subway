<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì„œìš¸ ì§€í•˜ì²  ì‹¤ì‹œê°„ ìœ„ì¹˜</title>
</head>
<body>
  <h1>ì„œìš¸ ì§€í•˜ì²  ì‹¤ì‹œê°„ ìœ„ì¹˜</h1>
  <select id="lineSelect">
    <option value="1í˜¸ì„ ">1í˜¸ì„ </option>
    <option value="2í˜¸ì„ ">2í˜¸ì„ </option>
    <option value="3í˜¸ì„ ">3í˜¸ì„ </option>
  </select>
  <div id="results">ë¡œë”© ì¤‘...</div>

  <script>
    const select = document.getElementById("lineSelect");
    const results = document.getElementById("results");

    async function fetchSubway(line) {
      results.innerText = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
      try {
        const res = await fetch(`/.netlify/functions/subway?line=${encodeURIComponent(line)}`);
        const data = await res.json();
        if (!data.realtimePosition || !data.realtimePosition.row) {
          results.innerText = "ì—´ì°¨ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.";
          return;
        }

        results.innerHTML = data.realtimePosition.row.map(train => `
          <div>
            ğŸš† ì—´ì°¨ë²ˆí˜¸: ${train.trainNo} <br/>
            ğŸ“ í˜„ì¬ì—­: ${train.statnNm} <br/>
            ğŸ” ìƒíƒœ: ${train.trainSttus} <br/>
            ğŸ›¤ ë°©í–¥: ${train.updnLine === '0' ? 'ìƒí–‰' : 'í•˜í–‰'}
          </div><hr/>
        `).join('');
      } catch (err) {
        results.innerText = "ğŸš« ìš”ì²­ ì‹¤íŒ¨: " + err.message;
      }
    }

    select.addEventListener("change", () => {
      fetchSubway(select.value);
    });

    fetchSubway(select.value);
  </script>
</body>
</html>