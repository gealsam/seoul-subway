<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>서울 지하철 실시간 위치</title>
</head>
<body>
  <h1>지하철 실시간 위치 정보</h1>
  <select id="lineSelect">
    <option value="1호선">1호선</option>
    <option value="2호선">2호선</option>
    <option value="3호선">3호선</option>
    <option value="4호선">4호선</option>
    <option value="5호선">5호선</option>
    <option value="6호선">6호선</option>
    <option value="7호선">7호선</option>
    <option value="8호선">8호선</option>
    <option value="9호선">9호선</option>
    <option value="경의중앙선">경의중앙선</option>
    <option value="공항철도">공항철도</option>
    <option value="경춘선">경춘선</option>
    <option value="신분당선">신분당선</option>
    <option value="수인분당선">수인분당선</option>
    <option value="의정부경전철">의정부경전철</option>
    <option value="에버라인">에버라인</option>
  </select>
  <div id="results">정보를 불러오는 중...</div>
  <script>
    const resultsDiv = document.getElementById('results');
    const select = document.getElementById('lineSelect');
    async function fetchData(line) {
      resultsDiv.textContent = '불러오는 중...';
      try {
        const res = await fetch(`/.netlify/functions/subway?line=${encodeURIComponent(line)}`);
        if (!res.ok) {
          resultsDiv.textContent = `API 요청 실패: ${res.status}`;
          return;
        }
        const data = await res.json();
        if (!data.realtimePosition?.row?.length) {
          resultsDiv.textContent = '열차 정보가 없습니다.';
          return;
        }
        resultsDiv.innerHTML = '';
        data.realtimePosition.row.forEach(train => {
          const div = document.createElement('div');
          div.innerHTML = `
            <p><strong>열차번호:</strong> ${train.trainNo}</p>
            <p><strong>현재역:</strong> ${train.statnNm}</p>
            <p><strong>상태:</strong> ${train.trainSttus}</p>
            <p><strong>종착역:</strong> ${train.destStationNm}</p>
            <p><strong>방향:</strong> ${train.updnLine === '0' ? '상행/내선' : '하행/외선'}</p>
            <hr/>
          `;
          resultsDiv.appendChild(div);
        });
      } catch (e) {
        resultsDiv.textContent = '데이터를 불러오는데 실패했습니다.';
        console.error(e);
      }
    }
    fetchData(select.value);
    select.addEventListener('change', () => fetchData(select.value));
  </script>
</body>
</html>